<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Gogi's Guest List</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .admin-card {
        margin-top: 12px;
        padding: 16px 14px 16px;
      }

      .admin-title {
        font-size: 18px;
        margin-bottom: 4px;
      }

      .admin-subtitle {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 12px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }

      th,
      td {
        padding: 6px 4px;
        text-align: left;
      }

      th {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        opacity: 0.8;
        border-bottom: 1px solid rgba(255, 255, 255, 0.18);
      }

      tbody tr:nth-child(odd) {
        background: rgba(255, 255, 255, 0.02);
      }

      .pill {
        border-radius: 999px;
        padding: 2px 8px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .pill-yes {
        background: rgba(51, 255, 204, 0.12);
        color: #c9fff1;
      }

      .pill-no {
        background: rgba(255, 255, 255, 0.06);
        color: #f5f5f5;
      }

      .timestamp {
        opacity: 0.7;
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <div class="bg-overlay"></div>
    <main class="page">
      <section class="hero">
        <div class="hero-badge">Host View</div>
        <h1 class="hero-title">Gogi's Guest List</h1>
        <p class="hero-subtitle">
          Private view. Keep this URL secret.
        </p>
      </section>

      <section class="card admin-card">
        <h2 class="admin-title">Confirmed Guests</h2>
        <p class="admin-subtitle">
          Live list of everyone who signed up.
        </p>

        <div id="admin-status" class="form-status"></div>

        <div id="table-wrapper" class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Donate</th>
                <th>Signed Up</th>
              </tr>
            </thead>
            <tbody id="guest-rows"></tbody>
          </table>
        </div>
      </section>
    </main>

    <script>
      (function () {
        const ACCESS_KEY = 'gogi_access';
        const hasAccess = localStorage.getItem(ACCESS_KEY) === '1';
        if (!hasAccess) {
          window.location.replace('/entry.html');
        }
      })();

      async function loadGuests() {
        const status = document.getElementById('admin-status');
        const tbody = document.getElementById('guest-rows');
        status.textContent = 'Loading guest list...';
        status.classList.remove('error', 'success');

        try {
          const res = await fetch('/api/guests');
          if (!res.ok) {
            throw new Error('Failed to load guests');
          }
          const guests = await res.json();

          status.textContent = guests.length
            ? guests.length + ' guest(s) on the list.'
            : 'No one has signed up yet.';

          tbody.innerHTML = '';
          guests.forEach((g, index) => {
            const tr = document.createElement('tr');

            const createdAt = g.createdAt
              ? new Date(g.createdAt)
              : null;

            tr.innerHTML = `
              <td>${index + 1}</td>
              <td>${g.name || ''}</td>
              <td>
                <span class="pill ${
                  g.willDonate ? 'pill-yes' : 'pill-no'
                }">
                  ${g.willDonate ? 'YES' : 'NO'}
                </span>
              </td>
              <td>
                <span class="timestamp">
                  ${
                    createdAt
                      ? createdAt.toLocaleString()
                      : ''
                  }
                </span>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } catch (err) {
          status.textContent = 'Could not load guest list.';
          status.classList.add('error');
        }
      }

      document.addEventListener('DOMContentLoaded', loadGuests);
    </script>
  </body>
</html>

